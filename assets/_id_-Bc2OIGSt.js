import{a1 as w,bY as F,am as B,a2 as C,al as N,v as I,as as L,X as f,U as v,L as a,a3 as o,Z as i,_ as l,V as M,Y as R,aQ as U,a6 as u,aP as A,an as D,a5 as E,bL as T,P as Y}from"./index-BhHLWAFw.js";import{c as $,d as j,u as O,e as Q}from"./index.esm-BnPdor6e.js";import{b}from"./route-block-B_A1xBdJ.js";import{a as X,b as d,V as Z}from"./VRow-DJTulxoI.js";import{V as z}from"./VDivider-Ebt4JwvZ.js";import{V as G}from"./VForm-BbeEctlh.js";const H={class:"text-center"},J={key:0,class:"mb-5"},K={class:"mb-5"},W={class:"mb-5"},y={__name:"[id]",setup(ee){const{api:V,apiAuth:h}=L(),m=F(),x=B(),p=C(),g=N(),e=I({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:"臉部彩妝"});(async()=>{try{const{data:r}=await V.get("/product/"+m.params.id);e.value=r.result,document.title=e.value.name+" ｜ 購物網站"}catch(r){console.log(r),m.push("/")}})();const k=$({quantity:j().typeError("商品數量錯誤").required("商品數量必填").positive("商品數量須大於 0").integer("商品數量必須為整數")}),{handleSubmit:S,isSubmitting:_}=O({validationSchema:k,initialValues:{quantity:1}}),c=Q("quantity"),q=S(async r=>{var t,n;if(!p.isLoggedIn){x.push("/login");return}try{const{data:s}=await h.patch("/user/cart",{product:e.value._id,quantity:r.quantity});p.cart=s.result,g({text:"商品已加入購物車",snackbarProps:{color:"green"}})}catch(s){console.log(s),g({text:((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"未知錯誤",snackbarProps:{color:"red"}})}});return(r,t)=>(v(),f(Y,null,[a(Z,null,{default:o(()=>[a(X,null,{default:o(()=>[a(d,{cols:"12"},{default:o(()=>[i("h1",H,l(e.value.name),1)]),_:1}),a(z),a(d,{cols:"12",md:"6"},{default:o(()=>[a(M,{src:e.value.image},null,8,["src"])]),_:1}),a(d,{cols:"12",md:"6"},{default:o(()=>{var n,s;return[e.value?(v(),f("p",J," 商品類別："+l(((n=e.value.category)==null?void 0:n.main)||"未分類")+l((s=e.value.category)!=null&&s.sub?"．"+e.value.category.sub:""),1)):R("",!0),i("p",K,"💲"+l(e.value.price),1),i("p",W,l(e.value.description),1),a(G,{disabled:u(_),onSubmit:U(u(q),["prevent"])},{default:o(()=>[a(A,{modelValue:u(c).value.value,"onUpdate:modelValue":t[0]||(t[0]=P=>u(c).value.value=P),modelModifiers:{number:!0},type:"number","error-messages":u(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(D,{type:"submit","prepend-icon":"mdi-cart",loading:u(_)},{default:o(()=>t[1]||(t[1]=[E("加入購物車")])),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]}),_:1})]),_:1})]),_:1}),a(T,{"model-value":!e.value.sell,class:"align-center justify-center",scrim:"black",opacity:"0.8",persistent:""},{default:o(()=>t[2]||(t[2]=[i("h1",{class:"text-center"},l("商品未上架"),-1)])),_:1},8,["model-value"])],64))}};typeof b=="function"&&b(y);const ne=w(y,[["__scopeId","data-v-942330a9"]]);export{ne as default};
