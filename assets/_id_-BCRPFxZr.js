import{bY as P,am as w,a2 as F,al as B,v as C,as as N,X as v,U as y,L as a,a3 as r,Z as i,_ as l,V as L,Y as M,aQ as R,a6 as u,aP as U,an as A,a5 as D,bL as E,P as I}from"./index-BWKVsAFn.js";import{c as T,d as Y,u as $,e as j}from"./index.esm-Cz6twAV_.js";import{b}from"./route-block-B_A1xBdJ.js";import{a as O,b as d,V as Q}from"./VRow-BTEv-rkC.js";import{V as X}from"./VDivider-DhAaCkaI.js";import{V as Z}from"./VForm-CIkTFTGj.js";const z={class:"text-center"},G={key:0},H={__name:"[id]",setup(J){const{api:V,apiAuth:_}=N(),m=P(),h=w(),p=F(),g=B(),e=C({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:"臉部彩妝"});(async()=>{try{const{data:o}=await V.get("/product/"+m.params.id);e.value=o.result,document.title=e.value.name+" ｜ 購物網站"}catch(o){console.log(o),m.push("/")}})();const x=T({quantity:Y().typeError("商品數量錯誤").required("商品數量必填").positive("商品數量須大於 0").integer("商品數量必須為整數")}),{handleSubmit:k,isSubmitting:f}=$({validationSchema:x,initialValues:{quantity:1}}),c=j("quantity"),S=k(async o=>{var t,n;if(!p.isLoggedIn){h.push("/login");return}try{const{data:s}=await _.patch("/user/cart",{product:e.value._id,quantity:o.quantity});p.cart=s.result,g({text:"商品已加入購物車",snackbarProps:{color:"green"}})}catch(s){console.log(s),g({text:((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)||"未知錯誤",snackbarProps:{color:"red"}})}});return(o,t)=>(y(),v(I,null,[a(Q,null,{default:r(()=>[a(O,null,{default:r(()=>[a(d,{cols:"12"},{default:r(()=>[i("h1",z,l(e.value.name),1)]),_:1}),a(X),a(d,{cols:"12",md:"6"},{default:r(()=>[a(L,{src:e.value.image},null,8,["src"])]),_:1}),a(d,{cols:"12",md:"6"},{default:r(()=>{var n,s;return[e.value?(y(),v("p",G," 商品類別："+l(((n=e.value.category)==null?void 0:n.main)||"未分類")+l((s=e.value.category)!=null&&s.sub?"．"+e.value.category.sub:""),1)):M("",!0),i("p",null,l(e.value.price),1),i("p",null,l(e.value.description),1),a(Z,{disabled:u(f),onSubmit:R(u(S),["prevent"])},{default:r(()=>[a(U,{modelValue:u(c).value.value,"onUpdate:modelValue":t[0]||(t[0]=q=>u(c).value.value=q),modelModifiers:{number:!0},type:"number","error-messages":u(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(A,{type:"submit","prepend-icon":"mdi-cart",loading:u(f)},{default:r(()=>t[1]||(t[1]=[D("加入購物車")])),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]}),_:1})]),_:1})]),_:1}),a(E,{"model-value":!e.value.sell,class:"align-center justify-center",scrim:"black",opacity:"0.8",persistent:""},{default:r(()=>t[2]||(t[2]=[i("h1",{class:"text-center"},l("商品未上架"),-1)])),_:1},8,["model-value"])],64))}};typeof b=="function"&&b(H);export{H as default};
