import{a2 as S,al as A,ak as $,v as q,c as f,S as V,U as c,a3 as s,L as a,Z as v,X as _,P as g,ao as z,Y as D,a5 as k,am as n,_ as y,b1 as I,V as P,ar as R}from"./index-T_veDYvW.js";import{b as C}from"./route-block-B_A1xBdJ.js";import{V as U,a as u}from"./VRow--F2gg7ax.js";import{V as i}from"./VDivider-Dd8ZUdqV.js";import{V as E,a as F}from"./VList-Dnkf20Zl.js";import{V as T}from"./VContainer-Db2pSK1w.js";import"./ssrBoot-BkOSUpkK.js";const X={__name:"cart",setup(Y){const{apiAuth:l}=R(),d=S(),b=A(),h=$(),o=q([]),p=async()=>{try{const{data:e}=await l.get("/user/cart");o.value=e.result}catch(e){console.log(e)}};p();const x=f(()=>o.value.reduce((e,r)=>e+r.product.price*r.quantity,0)),w=f(()=>o.value.length>0&&o.value.every(e=>e.product.sell)),m=async(e,r)=>{try{const{data:t}=await l.patch("/user/cart",{product:e,quantity:r});d.cart=t.result,p()}catch(t){console.log(t)}},B=async()=>{var e,r;try{await l.post("/order"),d.cart=0,b.push("/orders")}catch(t){console.log(t),h({text:((r=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:r.message)||"未知錯誤",snackbarProps:{color:"red"}})}};return(e,r)=>(c(),V(T,null,{default:s(()=>[a(U,null,{default:s(()=>[a(u,{cols:"12"},{default:s(()=>r[0]||(r[0]=[v("h1",{class:"text-center"},"購物車",-1)])),_:1}),a(i),a(u,{cols:"12"},{default:s(()=>[a(E,{lines:"two"},{default:s(()=>[(c(!0),_(g,null,z(o.value,(t,L)=>(c(),_(g,{key:t._id},[a(F,{title:t.product.name,subtitle:t.product.price,"active-class":"bg-grey-lighten-4",active:!t.product.sell},{prepend:s(()=>[a(I,{rounded:"0"},{default:s(()=>[a(P,{src:t.product.image},null,8,["src"])]),_:2},1024)]),append:s(()=>[a(n,{color:"red",icon:"mdi-minus",size:"x-small",class:"mr-4",onClick:N=>m(t.product._id,-1)},null,8,["onClick"]),k(" "+y(t.quantity)+" ",1),a(n,{color:"green",icon:"mdi-plus",size:"x-small",class:"ml-4",onClick:N=>m(t.product._id,1)},null,8,["onClick"])]),_:2},1032,["title","subtitle","active"]),L<o.value.length-1?(c(),V(i,{key:0})):D("",!0)],64))),128))]),_:1})]),_:1}),a(i),a(u,{cols:"12",class:"text-center"},{default:s(()=>[v("p",null,y("總計：$"+x.value),1),a(n,{color:"red",disabled:!w.value,onClick:B},{default:s(()=>r[1]||(r[1]=[k("結帳")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}))}};typeof C=="function"&&C(X);export{X as default};
