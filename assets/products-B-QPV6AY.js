import{g as me,p as fe,q as ge,aG as pe,aH as Ce,c as E,A as Ve,aI as be,aJ as _,L as o,M as j,aK as Fe,aL as xe,aM as Pe,v as g,s as Se,d as Me,o as Ue,w as G,b as Ae,aN as Ne,P as Z,aO as Re,aP as Ie,ah as ue,ax as Be,aQ as De,aR as Te,aS as $e,Q as J,a as ze,a7 as He,aT as qe,ak as Ee,aU as Ge,ar as Oe,a4 as Le,X as je,U as X,a3 as r,Z as Qe,am as Y,S as K,aj as W,a5 as D,_ as O,Y as Xe,V as Ye,an as Ze,aV as ee,aW as _e,a6 as s,aX as Je,aY as Ke,aZ as We,a_ as ea,a$ as aa}from"./index-T_veDYvW.js";import{c as ta,a as L,b as re,d as la,u as oa,e as R,V as sa}from"./index.esm-iFDhXU5o.js";import{b as ne}from"./route-block-B_A1xBdJ.js";import{V as ua,a as ae}from"./VRow--F2gg7ax.js";import{V as ra}from"./VDivider-Dd8ZUdqV.js";import{a as ie,m as na,V as ia,b as de}from"./VDataTable-CCsbPxU5.js";import{V as da}from"./VToolbar-BYqIWujZ.js";import{V as ca}from"./VContainer-Db2pSK1w.js";import"./VPagination-5qtbMg1l.js";import"./VList-Dnkf20Zl.js";import"./ssrBoot-BkOSUpkK.js";import"./VMenu-CK3nCrnx.js";const va=fe({...xe(),...Fe(na(),["inline"])},"VCheckbox"),ce=me()({name:"VCheckbox",inheritAttrs:!1,props:va(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,I){let{attrs:y,slots:k}=I;const d=ge(e,"modelValue"),{isFocused:v,focus:w,blur:c}=pe(e),T=Ce(),$=E(()=>e.id||`checkbox-${T}`);return Ve(()=>{const[P,B]=be(y),z=_.filterProps(e),S=ie.filterProps(e);return o(_,j({class:["v-checkbox",e.class]},P,z,{modelValue:d.value,"onUpdate:modelValue":C=>d.value=C,id:$.value,focused:v.value,style:e.style}),{...k,default:C=>{let{id:M,messagesId:U,isDisabled:h,isReadonly:A,isValid:p}=C;return o(ie,j(S,{id:M.value,"aria-describedby":U.value,disabled:h.value,readonly:A.value},B,{error:p.value===!1,modelValue:d.value,"onUpdate:modelValue":V=>d.value=V,onFocus:w,onBlur:c}),k)}})}),{}}}),ma=fe({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...xe(),...$e()},"VTextarea"),ve=me()({name:"VTextarea",directives:{Intersect:Pe},inheritAttrs:!1,props:ma(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,I){let{attrs:y,emit:k,slots:d}=I;const v=ge(e,"modelValue"),{isFocused:w,focus:c,blur:T}=pe(e),$=E(()=>typeof e.counterValue=="function"?e.counterValue(v.value):(v.value||"").toString().length),P=E(()=>{if(y.maxlength)return y.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function B(u,f){var l,a;!e.autofocus||!u||(a=(l=f[0].target)==null?void 0:l.focus)==null||a.call(l)}const z=g(),S=g(),C=Se(""),M=g(),U=E(()=>e.persistentPlaceholder||w.value||e.active);function h(){var u;M.value!==document.activeElement&&((u=M.value)==null||u.focus()),w.value||c()}function A(u){h(),k("click:control",u)}function p(u){k("mousedown:control",u)}function V(u){u.stopPropagation(),h(),J(()=>{v.value="",qe(e["onClick:clear"],u)})}function H(u){var l;const f=u.target;if(v.value=f.value,(l=e.modelModifiers)!=null&&l.trim){const a=[f.selectionStart,f.selectionEnd];J(()=>{f.selectionStart=a[0],f.selectionEnd=a[1]})}}const b=g(),F=g(+e.rows),q=E(()=>["plain","underlined"].includes(e.variant));Me(()=>{e.autoGrow||(F.value=+e.rows)});function m(){e.autoGrow&&J(()=>{if(!b.value||!S.value)return;const u=getComputedStyle(b.value),f=getComputedStyle(S.value.$el),l=parseFloat(u.getPropertyValue("--v-field-padding-top"))+parseFloat(u.getPropertyValue("--v-input-padding-top"))+parseFloat(u.getPropertyValue("--v-field-padding-bottom")),a=b.value.scrollHeight,i=parseFloat(u.lineHeight),t=Math.max(parseFloat(e.rows)*i+l,parseFloat(f.getPropertyValue("--v-input-control-height"))),n=parseFloat(e.maxRows)*i+l||1/0,N=He(a??0,t,n);F.value=Math.floor((N-l)/i),C.value=ze(N)})}Ue(m),G(v,m),G(()=>e.rows,m),G(()=>e.maxRows,m),G(()=>e.density,m);let x;return G(b,u=>{u?(x=new ResizeObserver(m),x.observe(b.value)):x==null||x.disconnect()}),Ae(()=>{x==null||x.disconnect()}),Ve(()=>{const u=!!(d.counter||e.counter||e.counterValue),f=!!(u||d.details),[l,a]=be(y),{modelValue:i,...t}=_.filterProps(e),n=Ne(e);return o(_,j({ref:z,modelValue:v.value,"onUpdate:modelValue":N=>v.value=N,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":q.value},e.class],style:e.style},l,t,{centerAffix:F.value===1&&!q.value,focused:w.value}),{...d,default:N=>{let{id:Q,isDisabled:te,isDirty:le,isReadonly:ye,isValid:ke}=N;return o(Ie,j({ref:S,style:{"--v-textarea-control-height":C.value},onClick:A,onMousedown:p,"onClick:clear":V,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},n,{id:Q.value,active:U.value||le.value,centerAffix:F.value===1&&!q.value,dirty:le.value||e.dirty,disabled:te.value,focused:w.value,error:ke.value===!1}),{...d,default:we=>{let{props:{class:oe,...se}}=we;return o(Z,null,[e.prefix&&o("span",{class:"v-text-field__prefix"},[e.prefix]),ue(o("textarea",j({ref:M,class:oe,value:v.value,onInput:H,autofocus:e.autofocus,readonly:ye.value,disabled:te.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:h,onBlur:T},se,a),null),[[Be("intersect"),{handler:B},null,{once:!0}]]),e.autoGrow&&ue(o("textarea",{class:[oe,"v-textarea__sizer"],id:`${se.id}-sizer`,"onUpdate:modelValue":he=>v.value=he,ref:b,readonly:!0,"aria-hidden":"true"},null),[[De,v.value]]),e.suffix&&o("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:f?N=>{var Q;return o(Z,null,[(Q=d.details)==null?void 0:Q.call(d,N),u&&o(Z,null,[o("span",null,null),o(Re,{active:e.persistentCounter||w.value,value:$.value,max:P.value,disabled:e.disabled},d.counter)])])}:void 0})}),Te({},z,S,M)}}),fa={__name:"products",setup(e){const{apiAuth:I}=Oe(),y=Ee(),k=Ge([]),d=g(""),v=[{title:"ID",key:"_id",sortable:!0},{title:"圖片",key:"image",sortable:!1},{title:"名稱",key:"name",sortable:!0},{title:"類別",key:"category",sortable:!0},{title:"售價",key:"price",sortable:!0},{title:"說明",key:"description",sortable:!1},{title:"新舊狀態",key:"used",sortable:!0},{title:"二手情形說明",key:"usedNote",sortable:!1},{title:"販售狀態",key:"sell",sortable:!0},{title:"建立時間",key:"createdAt",sortable:!0},{title:"更新時間",key:"updatedAt",sortable:!0},{title:"編輯商品",key:"edit",sortable:!1}],w=async()=>{var l,a;try{const{data:i}=await I.get("/product/all");k.push(...i.result)}catch(i){console.log(i),y({text:((a=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:a.message)||"發生未知錯誤",snackbarProps:{color:"red"}})}};w();const c=g({open:!1,id:""}),T=l=>{l?(c.value.id=l._id,U.value.value=l.name,h.value.value=l.price,A.value.value=l.description,p.value.value=l.category.main,V.value.value=l.category.sub,H.value.value=l.used,b.value.value=l.usedNote,F.value.value=l.sell):(p.value.value="",V.value.value=""),u(),c.value.open=!0},$=()=>{M(),c.value.id="",c.value.open=!1,q.value.deleteFileRecord(),p.value.value="",V.value.value=""},P=g([{text:"臉部彩妝",value:"臉部彩妝",subcategories:["粉底","修容","打亮","腮紅"]},{text:"眼部彩妝",value:"眼部彩妝",subcategories:["眼彩","眉彩"]},{text:"唇部彩妝",value:"唇部彩妝",subcategories:[]},{text:"日常保養",value:"日常保養",subcategories:["保養品","乳液乳霜","面膜","化妝水"]},{text:"臉部清潔",value:"臉部清潔",subcategories:["卸妝品","洗面乳"]},{text:"上妝用具",value:"上妝用具",subcategories:["刷具","粉底刮刀","美妝蛋"]}]),B=g([]),z=E(()=>ta({name:L().required("商品名稱必填"),price:la().typeError("商品價格必填").required("商品價格必填").min(0,"價格區間不符"),description:L().required("商品說明必填"),category:L().required("請選擇主分類").oneOf(P.value.map(l=>l.value),"分類不存在"),subcategory:L().test("subcategory","請選擇子分類",function(l){const a=P.value.find(i=>i.value===this.parent.category);return a?this.parent.category==="唇部彩妝"?!0:a.subcategories.includes(l):!1}),sell:re().required("販售狀態必填"),used:re().required("二手狀態必填"),usedNote:L().nullable()})),{handleSubmit:S,isSubmitting:C,resetForm:M}=oa({validationSchema:z,initialValues:{name:"",price:null,category:"",subcategory:"",sell:!1,used:!1,description:"",usedNote:""}}),U=R("name"),h=R("price"),A=R("description"),p=R("category"),V=R("subcategory"),H=R("used"),b=R("usedNote"),F=R("sell"),q=g(null),m=g([]),x=g([]),u=(l=!1)=>{const a=P.value.find(i=>i.value===p.value.value);B.value=a?a.subcategories:[],l&&V.resetField()},f=S(async l=>{var a,i,t;if(console.log("handleSubmit的地方"),!((a=m.value[0])!=null&&a.error)){if(c.value.id.length===0&&m.value.length===0){y({text:"商品圖片必填",snackbarProps:{color:"red"}});return}try{const n=new FormData;n.append("name",l.name),n.append("price",l.price),n.append("description",l.description),n.append("category.main",l.category),n.append("category.sub",l.subcategory),n.append("sell",l.sell),n.append("used",l.used),n.append("usedNote",l.usedNote),m.value.length>0&&n.append("image",m.value[0].file),c.value.id.length>0?await I.patch("/product/"+c.value.id,n):await I.post("/product",n),k.splice(0,k.length),w(),y({text:c.value.id.length>0?"商品編輯成功":"商品新增成功",snackbarProps:{color:"green"}}),$()}catch(n){console.log(n),y({text:((t=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:t.message)||"發生未知錯誤",snackbarProps:{color:"red"}})}}});return(l,a)=>{const i=Le("VueFileAgent");return X(),je(Z,null,[o(ca,null,{default:r(()=>[o(ua,null,{default:r(()=>[o(ae,{cols:"12"},{default:r(()=>a[14]||(a[14]=[Qe("h1",{class:"text-center"},"商品管理",-1)])),_:1}),o(ra),o(ae,{cols:"12"},{default:r(()=>[o(ia,{items:k,headers:v,search:d.value},{top:r(()=>[o(da,null,{default:r(()=>[o(Y,{onClick:a[0]||(a[0]=t=>T(null))},{default:r(()=>a[15]||(a[15]=[D("新增商品")])),_:1}),o(Ze),o(ae,{cols:"3"},{default:r(()=>[o(ee,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=t=>d.value=t),density:"compact",label:"Search","prepend-inner-icon":"mdi-magnify",variant:"solo-filled",flat:"","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1})]),_:1})]),"item.image":r(({value:t})=>[o(Ye,{src:t,height:"50"},null,8,["src"])]),"item.sell":r(({value:t})=>[t?(X(),K(W,{key:0,icon:"mdi-check"})):Xe("",!0)]),"item.createdAt":r(({value:t})=>[D(O(new Date(t).toLocaleString()),1)]),"item.updatedAt":r(({value:t})=>[D(O(new Date(t).toLocaleString()),1)]),"item.category":r(({value:t})=>[D(O(t.main)+" - "+O(t.sub),1)]),"item.used":r(({value:t})=>[t?(X(),K(W,{key:0,icon:"mdi-new-box"})):(X(),K(W,{key:1,icon:"mdi-bandage"}))]),"item.edit":r(({item:t})=>[o(Y,{icon:"mdi-pencil",variant:"text",onClick:n=>T(t)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1})]),_:1})]),_:1}),o(aa,{modelValue:c.value.open,"onUpdate:modelValue":a[13]||(a[13]=t=>c.value.open=t),persistent:""},{default:r(()=>[o(sa,{disabled:s(C),onSubmit:_e(s(f),["prevent"])},{default:r(()=>[o(Je,null,{default:r(()=>[o(Ke,null,{default:r(()=>[D(O(c.value.id?"編輯商品":"新增商品"),1)]),_:1}),o(We,null,{default:r(()=>[o(ee,{modelValue:s(U).value.value,"onUpdate:modelValue":a[2]||(a[2]=t=>s(U).value.value=t),label:"商品名稱","error-messages":s(U).errorMessage.value},null,8,["modelValue","error-messages"]),o(ee,{modelValue:s(h).value.value,"onUpdate:modelValue":a[3]||(a[3]=t=>s(h).value.value=t),label:"商品價格","error-messages":s(h).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),o(de,{modelValue:s(p).value.value,"onUpdate:modelValue":[a[4]||(a[4]=t=>s(p).value.value=t),a[5]||(a[5]=t=>u(!0))],"error-messages":s(p).errorMessage.value,items:P.value,label:"商品主分類","item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items"]),o(de,{modelValue:s(V).value.value,"onUpdate:modelValue":a[6]||(a[6]=t=>s(V).value.value=t),"error-messages":s(V).errorMessage.value,items:B.value,label:"商品子分類","item-title":"text","item-value":"value",disabled:B.value.length===0},null,8,["modelValue","error-messages","items","disabled"]),o(ce,{modelValue:s(F).value.value,"onUpdate:modelValue":a[7]||(a[7]=t=>s(F).value.value=t),label:"販售狀態","error-messages":s(F).errorMessage.value},null,8,["modelValue","error-messages"]),o(ce,{modelValue:s(H).value.value,"onUpdate:modelValue":a[8]||(a[8]=t=>s(H).value.value=t),label:"是否為新品","error-messages":s(H).errorMessage.value},null,8,["modelValue","error-messages"]),o(ve,{modelValue:s(A).value.value,"onUpdate:modelValue":a[9]||(a[9]=t=>s(A).value.value=t),label:"商品說明","error-messages":s(A).errorMessage.value},null,8,["modelValue","error-messages"]),o(ve,{modelValue:s(b).value.value,"onUpdate:modelValue":a[10]||(a[10]=t=>s(b).value.value=t),label:"二手情形說明","error-messages":s(b).errorMessage.value},null,8,["modelValue","error-messages"]),o(i,{ref_key:"fileAgent",ref:q,modelValue:m.value,"onUpdate:modelValue":a[11]||(a[11]=t=>m.value=t),"raw-model-value":x.value,"onUpdate:rawModelValue":a[12]||(a[12]=t=>x.value=t),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"點擊或拖曳檔案至此","error-text":{type:"檔案類型錯誤",size:"檔案尺寸超過 1MB"}},null,8,["modelValue","raw-model-value"])]),_:1}),o(ea,null,{default:r(()=>[o(Y,{onClick:$},{default:r(()=>a[16]||(a[16]=[D("取消")])),_:1}),o(Y,{type:"submit",loading:s(C)},{default:r(()=>a[17]||(a[17]=[D("確認")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof ne=="function"&&ne(fa);export{fa as default};
